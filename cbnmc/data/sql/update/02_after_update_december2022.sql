-- Maj vers les nouveaux identifiants des organismes.
-- Script à lancer après la maj des données du CBNMC.
-- Change orgnism UUID after update (december 2022)
-- psql -U geonatadmin -h localhost -d geonature2db -f ~/data/cbnmc/data/sql/update/02_*

WITH cor_organisme AS (
    SELECT
        ((orgs.json_org) ->> 'uuid_organisme')::uuid uuid_organisme,
        bo_chloris.id_organisme id_org_old,
        bo_chloris.nom_organisme nom_old,
        ((orgs.json_org) ->> 'uuid_inpn')::uuid uuid_inpn,
        bo_inpn.id_organisme id_org_new,
        bo_inpn.nom_organisme nom_new
    FROM (
            SELECT
                unnest(
                    '{"{\"uuid_organisme\":\"23d397d4-ec11-4d95-99c5-b6b5900aa176\",\"uuid_inpn\":\"139561cc-9055-43bd-aa59-911fbd87d917\"}","{\"uuid_organisme\":\"7e4c5950-aeb8-4194-b37f-67230cc5cc5f\",\"uuid_inpn\":\"1425EE63-D4F9-4FD5-94D8-2566BCD5E3E0\"}","{\"uuid_organisme\":\"3d284c5e-1005-4484-9c18-2e4771b419b2\",\"uuid_inpn\":\"14ba96b3-775a-445f-ae8c-a85a00a01835\"}","{\"uuid_organisme\":\"0fbc3acf-5063-42da-b0da-8a6bc48c6df4\",\"uuid_inpn\":\"15b23e2d-a88b-4c77-9f3e-b62dcf41fed4\"}","{\"uuid_organisme\":\"b865eb91-b78b-462e-bda4-55876b50a4c4\",\"uuid_inpn\":\"27C60AE3-D841-4197-B21E-797894EA0835\"}","{\"uuid_organisme\":\"1960c348-028e-4345-b24b-d722fc13e656\",\"uuid_inpn\":\"382179EC-F4A2-4019-A0BB-B54105C7C63F\"}","{\"uuid_organisme\":\"4de1e833-4a26-4474-a917-c0d5769c8aac\",\"uuid_inpn\":\"4008F6FB-C067-4EE7-8688-CFEE6EBAC324\"}","{\"uuid_organisme\":\"6c2e7208-75de-440b-b5f1-3a5ad5cb24e8\",\"uuid_inpn\":\"4e4a6b2d-769d-4bf6-8835-bba8b973fc35\"}","{\"uuid_organisme\":\"3d6db91d-1f9c-423b-99b3-a595f20bbef3\",\"uuid_inpn\":\"56BC65D1-9A34-4539-B25A-85B55A2A2CC5\"}","{\"uuid_organisme\":\"e127cb86-4fc3-41cb-8984-18cdcf4f8060\",\"uuid_inpn\":\"5A433BD0-1FBE-25D9-E053-2614A8C026F8\"}","{\"uuid_organisme\":\"799da30e-f934-4904-95ea-2113f384518c\",\"uuid_inpn\":\"5A433BD0-1FC0-25D9-E053-2614A8C026F8\"}","{\"uuid_organisme\":\"7f53923e-1bc2-4321-add9-96770c6c3846\",\"uuid_inpn\":\"5A433BD0-1FC6-25D9-E053-2614A8C026F8\"}","{\"uuid_organisme\":\"6c66b0f5-c07a-4ed9-b104-39152ec4b238\",\"uuid_inpn\":\"5A433BD0-1FC9-25D9-E053-2614A8C026F8\"}","{\"uuid_organisme\":\"c8b281ba-d8bb-4b77-a059-430df48c0040\",\"uuid_inpn\":\"5A433BD0-1FF6-25D9-E053-2614A8C026F8\"}","{\"uuid_organisme\":\"391409ac-3412-4986-ab46-497f1303a66c\",\"uuid_inpn\":\"5A433BD0-200F-25D9-E053-2614A8C026F8\"}","{\"uuid_organisme\":\"81ec2dc3-6ed5-4787-af7c-51848f0db75c\",\"uuid_inpn\":\"5A433BD0-200F-25D9-E053-2614A8C026F8\"}","{\"uuid_organisme\":\"76049d34-ad02-4e48-8a1a-e629f13daa1c\",\"uuid_inpn\":\"5A433BD0-2032-25D9-E053-2614A8C026F8\"}","{\"uuid_organisme\":\"3fc4579e-7e81-4233-95b2-21d0d519485e\",\"uuid_inpn\":\"5A433BD0-203A-25D9-E053-2614A8C026F8\"}","{\"uuid_organisme\":\"04942dac-ef78-4db9-9971-b04943586682\",\"uuid_inpn\":\"5A433BD0-2047-25D9-E053-2614A8C026F8\"}","{\"uuid_organisme\":\"4ba9dcf8-ad4a-49cf-bcb7-7204a240120c\",\"uuid_inpn\":\"5A433BD0-2062-25D9-E053-2614A8C026F8\"}","{\"uuid_organisme\":\"40039663-1fb9-4eb0-826b-4f4137c669df\",\"uuid_inpn\":\"5A433BD0-2070-25D9-E053-2614A8C026F8\"}","{\"uuid_organisme\":\"3289d3bf-f084-47be-a88a-b680e90b7092\",\"uuid_inpn\":\"5A433BD0-207B-25D9-E053-2614A8C026F8\"}","{\"uuid_organisme\":\"91e748f2-6cf7-49ed-844c-a8f57acd4a0b\",\"uuid_inpn\":\"5A433BD0-2083-25D9-E053-2614A8C026F8\"}","{\"uuid_organisme\":\"11123ed5-883d-45f0-8e9d-cd64ce31fd7b\",\"uuid_inpn\":\"5A433BD0-20E5-25D9-E053-2614A8C026F8\"}","{\"uuid_organisme\":\"0c142854-5a21-4fe9-8cfc-75231c2a9ffa\",\"uuid_inpn\":\"5A433BD0-20FB-25D9-E053-2614A8C026F8\"}","{\"uuid_organisme\":\"19757824-56fe-4e4a-b0f4-fea6adc2a870\",\"uuid_inpn\":\"5A433BD0-2111-25D9-E053-2614A8C026F8\"}","{\"uuid_organisme\":\"c4c9a1ef-b167-4413-966e-e71aecb696be\",\"uuid_inpn\":\"5a7c3409-1ddf-446b-b595-3677dd8d8971\"}","{\"uuid_organisme\":\"8ed10b67-cbb6-4a64-bdc3-928248f77759\",\"uuid_inpn\":\"5BD3E675-AA1F-2EBB-E053-2614A8C0CDC5\"}","{\"uuid_organisme\":\"b45837b6-f808-4b5d-84f9-41155e69c8f6\",\"uuid_inpn\":\"5be405eb-6de7-48b8-87f3-96c3d02badee\"}","{\"uuid_organisme\":\"5c754342-0500-4db8-b358-74e4a5101f9d\",\"uuid_inpn\":\"5C4B022A-17FA-6F1E-E053-2614A8C09D9F\"}","{\"uuid_organisme\":\"42ba1bbd-9bf6-40f9-9b29-41232dd72d24\",\"uuid_inpn\":\"5C4B022A-17FD-6F1E-E053-2614A8C09D9F\"}","{\"uuid_organisme\":\"8c51f403-8bae-421b-b90a-431618a5945c\",\"uuid_inpn\":\"5F301924-F1F4-5DA1-E053-2614A8C0F028\"}","{\"uuid_organisme\":\"530e3094-2b1b-4a79-b2c6-ab838bba0b78\",\"uuid_inpn\":\"5F301924-F1FA-5DA1-E053-2614A8C0F028\"}","{\"uuid_organisme\":\"ce582053-ec91-4313-9226-be34bd6a477f\",\"uuid_inpn\":\"5F832FC3-7E52-3553-E053-2614A8C09903\"}","{\"uuid_organisme\":\"b593a4a6-d789-4913-a376-558c7832aab2\",\"uuid_inpn\":\"60E6CAA2-88A3-41D3-B6D7-E02E271AF1F4\"}","{\"uuid_organisme\":\"e016bf09-eafc-43b2-9ea4-72240c1cf15a\",\"uuid_inpn\":\"62CDA494-5A11-44E1-E053-2614A8C0FAA0\"}","{\"uuid_organisme\":\"bd4b305c-9e84-4431-b79e-3fdfeb39ca0d\",\"uuid_inpn\":\"62F6DC18-1B5E-0553-E053-2614A8C052D6\"}","{\"uuid_organisme\":\"54e22f73-d59b-4e8b-87f4-4ccf58b19e21\",\"uuid_inpn\":\"62F6DC18-1B68-0553-E053-2614A8C052D6\"}","{\"uuid_organisme\":\"f04c3276-6613-462e-a617-37795ebf9e09\",\"uuid_inpn\":\"63220E12-87AA-43BD-B430-B713D1A32CE1\"}","{\"uuid_organisme\":\"4f42ac1a-98e0-4bf1-b377-df57960634bb\",\"uuid_inpn\":\"6FC806F8-A359-4FD8-98E5-EB4DD338979F\"}","{\"uuid_organisme\":\"8777011f-e32e-43e8-916c-231f52b92602\",\"uuid_inpn\":\"853A5C59-1736-4A0D-81BE-9CDCF04CED7A\"}","{\"uuid_organisme\":\"b760a61b-258b-487e-8aa3-0f39e718c97a\",\"uuid_inpn\":\"87b71ba2-eb98-11eb-b2d4-005056aa3715\"}","{\"uuid_organisme\":\"77115a43-2784-4936-b25f-8b79bd84f8cd\",\"uuid_inpn\":\"887AE811-4A08-422B-B57D-C3B3D62CCF9C\"}","{\"uuid_organisme\":\"b343f6cd-f963-4f5a-b0cf-5746cb538dde\",\"uuid_inpn\":\"92E950C4-0D5F-4EB1-B010-FFF810E5E567\"}","{\"uuid_organisme\":\"e01fd6dd-4d79-459f-9fd3-2b0306f237d0\",\"uuid_inpn\":\"95343124-0CAA-4C4D-A889-250B5DE37B52\"}","{\"uuid_organisme\":\"1bde1f82-db48-495d-88e8-c6189a440ff0\",\"uuid_inpn\":\"A14A142D-A3E0-126F-E053-2614A8C0CFBE\"}","{\"uuid_organisme\":\"8a40fb1f-23e2-4006-beb1-7499fc62e998\",\"uuid_inpn\":\"A14A142D-A482-126F-E053-2614A8C0CFBE\"}","{\"uuid_organisme\":\"948c57bf-4db6-4fd1-a9b0-decf0ef8612d\",\"uuid_inpn\":\"AAA5029C-FBE2-6BE5-E053-2614A8C07765\"}","{\"uuid_organisme\":\"0246989d-5384-49a0-8d66-c7e02e3878e9\",\"uuid_inpn\":\"ac1149e7-e099-4257-b9f7-def5050533e3\"}","{\"uuid_organisme\":\"624854a8-9ba5-46ca-9bbf-1c642ffaaffd\",\"uuid_inpn\":\"B14AA21B-AA11-44A6-B400-1DC1B48D3869\"}","{\"uuid_organisme\":\"68e254f7-bb20-4ab4-9c87-9b78902a9f0c\",\"uuid_inpn\":\"BF904CB5-14FF-4B92-81E6-B209D37D6D41\"}","{\"uuid_organisme\":\"2c2fb080-990e-4829-a951-65417c573731\",\"uuid_inpn\":\"e19e719d-ac17-4b05-827f-c625efe6d31d\"}","{\"uuid_organisme\":\"a8767c79-4dd9-4625-91d1-b6c46bc1d13a\",\"uuid_inpn\":\"F2F69A1A-CDAA-4278-93EA-FA9F4D69E855\"}","{\"uuid_organisme\":\"29c0ca0d-d168-4ce7-b9ed-ebbd5c2a1417\",\"uuid_inpn\":\"F60878DD-C8C0-45A3-9DC6-10C964925690\"}"}' :: json []
                ) json_org
        ) AS orgs
        LEFT JOIN utilisateurs.bib_organismes AS bo_chloris
            ON ((orgs.json_org) ->> 'uuid_organisme')::uuid = bo_chloris.uuid_organisme
        LEFT JOIN utilisateurs.bib_organismes AS bo_inpn
            ON ((orgs.json_org) ->> 'uuid_inpn')::uuid = bo_inpn.uuid_organisme
)
UPDATE gn_meta.cor_acquisition_framework_actor AS aa
SET id_organism = id_org_new
FROM cor_organisme AS co
WHERE aa.id_organism = co.id_org_old ;
--update 9l


WITH cor_organisme AS (
    SELECT
        ((orgs.json_org) ->> 'uuid_organisme')::uuid uuid_organisme,
        bo_chloris.id_organisme id_org_old,
        bo_chloris.nom_organisme nom_old,
        ((orgs.json_org) ->> 'uuid_inpn')::uuid uuid_inpn,
        bo_inpn.id_organisme id_org_new,
        bo_inpn.nom_organisme nom_new
    FROM (
            SELECT
                unnest(
                    '{"{\"uuid_organisme\":\"23d397d4-ec11-4d95-99c5-b6b5900aa176\",\"uuid_inpn\":\"139561cc-9055-43bd-aa59-911fbd87d917\"}","{\"uuid_organisme\":\"7e4c5950-aeb8-4194-b37f-67230cc5cc5f\",\"uuid_inpn\":\"1425EE63-D4F9-4FD5-94D8-2566BCD5E3E0\"}","{\"uuid_organisme\":\"3d284c5e-1005-4484-9c18-2e4771b419b2\",\"uuid_inpn\":\"14ba96b3-775a-445f-ae8c-a85a00a01835\"}","{\"uuid_organisme\":\"0fbc3acf-5063-42da-b0da-8a6bc48c6df4\",\"uuid_inpn\":\"15b23e2d-a88b-4c77-9f3e-b62dcf41fed4\"}","{\"uuid_organisme\":\"b865eb91-b78b-462e-bda4-55876b50a4c4\",\"uuid_inpn\":\"27C60AE3-D841-4197-B21E-797894EA0835\"}","{\"uuid_organisme\":\"1960c348-028e-4345-b24b-d722fc13e656\",\"uuid_inpn\":\"382179EC-F4A2-4019-A0BB-B54105C7C63F\"}","{\"uuid_organisme\":\"4de1e833-4a26-4474-a917-c0d5769c8aac\",\"uuid_inpn\":\"4008F6FB-C067-4EE7-8688-CFEE6EBAC324\"}","{\"uuid_organisme\":\"6c2e7208-75de-440b-b5f1-3a5ad5cb24e8\",\"uuid_inpn\":\"4e4a6b2d-769d-4bf6-8835-bba8b973fc35\"}","{\"uuid_organisme\":\"3d6db91d-1f9c-423b-99b3-a595f20bbef3\",\"uuid_inpn\":\"56BC65D1-9A34-4539-B25A-85B55A2A2CC5\"}","{\"uuid_organisme\":\"e127cb86-4fc3-41cb-8984-18cdcf4f8060\",\"uuid_inpn\":\"5A433BD0-1FBE-25D9-E053-2614A8C026F8\"}","{\"uuid_organisme\":\"799da30e-f934-4904-95ea-2113f384518c\",\"uuid_inpn\":\"5A433BD0-1FC0-25D9-E053-2614A8C026F8\"}","{\"uuid_organisme\":\"7f53923e-1bc2-4321-add9-96770c6c3846\",\"uuid_inpn\":\"5A433BD0-1FC6-25D9-E053-2614A8C026F8\"}","{\"uuid_organisme\":\"6c66b0f5-c07a-4ed9-b104-39152ec4b238\",\"uuid_inpn\":\"5A433BD0-1FC9-25D9-E053-2614A8C026F8\"}","{\"uuid_organisme\":\"c8b281ba-d8bb-4b77-a059-430df48c0040\",\"uuid_inpn\":\"5A433BD0-1FF6-25D9-E053-2614A8C026F8\"}","{\"uuid_organisme\":\"391409ac-3412-4986-ab46-497f1303a66c\",\"uuid_inpn\":\"5A433BD0-200F-25D9-E053-2614A8C026F8\"}","{\"uuid_organisme\":\"81ec2dc3-6ed5-4787-af7c-51848f0db75c\",\"uuid_inpn\":\"5A433BD0-200F-25D9-E053-2614A8C026F8\"}","{\"uuid_organisme\":\"76049d34-ad02-4e48-8a1a-e629f13daa1c\",\"uuid_inpn\":\"5A433BD0-2032-25D9-E053-2614A8C026F8\"}","{\"uuid_organisme\":\"3fc4579e-7e81-4233-95b2-21d0d519485e\",\"uuid_inpn\":\"5A433BD0-203A-25D9-E053-2614A8C026F8\"}","{\"uuid_organisme\":\"04942dac-ef78-4db9-9971-b04943586682\",\"uuid_inpn\":\"5A433BD0-2047-25D9-E053-2614A8C026F8\"}","{\"uuid_organisme\":\"4ba9dcf8-ad4a-49cf-bcb7-7204a240120c\",\"uuid_inpn\":\"5A433BD0-2062-25D9-E053-2614A8C026F8\"}","{\"uuid_organisme\":\"40039663-1fb9-4eb0-826b-4f4137c669df\",\"uuid_inpn\":\"5A433BD0-2070-25D9-E053-2614A8C026F8\"}","{\"uuid_organisme\":\"3289d3bf-f084-47be-a88a-b680e90b7092\",\"uuid_inpn\":\"5A433BD0-207B-25D9-E053-2614A8C026F8\"}","{\"uuid_organisme\":\"91e748f2-6cf7-49ed-844c-a8f57acd4a0b\",\"uuid_inpn\":\"5A433BD0-2083-25D9-E053-2614A8C026F8\"}","{\"uuid_organisme\":\"11123ed5-883d-45f0-8e9d-cd64ce31fd7b\",\"uuid_inpn\":\"5A433BD0-20E5-25D9-E053-2614A8C026F8\"}","{\"uuid_organisme\":\"0c142854-5a21-4fe9-8cfc-75231c2a9ffa\",\"uuid_inpn\":\"5A433BD0-20FB-25D9-E053-2614A8C026F8\"}","{\"uuid_organisme\":\"19757824-56fe-4e4a-b0f4-fea6adc2a870\",\"uuid_inpn\":\"5A433BD0-2111-25D9-E053-2614A8C026F8\"}","{\"uuid_organisme\":\"c4c9a1ef-b167-4413-966e-e71aecb696be\",\"uuid_inpn\":\"5a7c3409-1ddf-446b-b595-3677dd8d8971\"}","{\"uuid_organisme\":\"8ed10b67-cbb6-4a64-bdc3-928248f77759\",\"uuid_inpn\":\"5BD3E675-AA1F-2EBB-E053-2614A8C0CDC5\"}","{\"uuid_organisme\":\"b45837b6-f808-4b5d-84f9-41155e69c8f6\",\"uuid_inpn\":\"5be405eb-6de7-48b8-87f3-96c3d02badee\"}","{\"uuid_organisme\":\"5c754342-0500-4db8-b358-74e4a5101f9d\",\"uuid_inpn\":\"5C4B022A-17FA-6F1E-E053-2614A8C09D9F\"}","{\"uuid_organisme\":\"42ba1bbd-9bf6-40f9-9b29-41232dd72d24\",\"uuid_inpn\":\"5C4B022A-17FD-6F1E-E053-2614A8C09D9F\"}","{\"uuid_organisme\":\"8c51f403-8bae-421b-b90a-431618a5945c\",\"uuid_inpn\":\"5F301924-F1F4-5DA1-E053-2614A8C0F028\"}","{\"uuid_organisme\":\"530e3094-2b1b-4a79-b2c6-ab838bba0b78\",\"uuid_inpn\":\"5F301924-F1FA-5DA1-E053-2614A8C0F028\"}","{\"uuid_organisme\":\"ce582053-ec91-4313-9226-be34bd6a477f\",\"uuid_inpn\":\"5F832FC3-7E52-3553-E053-2614A8C09903\"}","{\"uuid_organisme\":\"b593a4a6-d789-4913-a376-558c7832aab2\",\"uuid_inpn\":\"60E6CAA2-88A3-41D3-B6D7-E02E271AF1F4\"}","{\"uuid_organisme\":\"e016bf09-eafc-43b2-9ea4-72240c1cf15a\",\"uuid_inpn\":\"62CDA494-5A11-44E1-E053-2614A8C0FAA0\"}","{\"uuid_organisme\":\"bd4b305c-9e84-4431-b79e-3fdfeb39ca0d\",\"uuid_inpn\":\"62F6DC18-1B5E-0553-E053-2614A8C052D6\"}","{\"uuid_organisme\":\"54e22f73-d59b-4e8b-87f4-4ccf58b19e21\",\"uuid_inpn\":\"62F6DC18-1B68-0553-E053-2614A8C052D6\"}","{\"uuid_organisme\":\"f04c3276-6613-462e-a617-37795ebf9e09\",\"uuid_inpn\":\"63220E12-87AA-43BD-B430-B713D1A32CE1\"}","{\"uuid_organisme\":\"4f42ac1a-98e0-4bf1-b377-df57960634bb\",\"uuid_inpn\":\"6FC806F8-A359-4FD8-98E5-EB4DD338979F\"}","{\"uuid_organisme\":\"8777011f-e32e-43e8-916c-231f52b92602\",\"uuid_inpn\":\"853A5C59-1736-4A0D-81BE-9CDCF04CED7A\"}","{\"uuid_organisme\":\"b760a61b-258b-487e-8aa3-0f39e718c97a\",\"uuid_inpn\":\"87b71ba2-eb98-11eb-b2d4-005056aa3715\"}","{\"uuid_organisme\":\"77115a43-2784-4936-b25f-8b79bd84f8cd\",\"uuid_inpn\":\"887AE811-4A08-422B-B57D-C3B3D62CCF9C\"}","{\"uuid_organisme\":\"b343f6cd-f963-4f5a-b0cf-5746cb538dde\",\"uuid_inpn\":\"92E950C4-0D5F-4EB1-B010-FFF810E5E567\"}","{\"uuid_organisme\":\"e01fd6dd-4d79-459f-9fd3-2b0306f237d0\",\"uuid_inpn\":\"95343124-0CAA-4C4D-A889-250B5DE37B52\"}","{\"uuid_organisme\":\"1bde1f82-db48-495d-88e8-c6189a440ff0\",\"uuid_inpn\":\"A14A142D-A3E0-126F-E053-2614A8C0CFBE\"}","{\"uuid_organisme\":\"8a40fb1f-23e2-4006-beb1-7499fc62e998\",\"uuid_inpn\":\"A14A142D-A482-126F-E053-2614A8C0CFBE\"}","{\"uuid_organisme\":\"948c57bf-4db6-4fd1-a9b0-decf0ef8612d\",\"uuid_inpn\":\"AAA5029C-FBE2-6BE5-E053-2614A8C07765\"}","{\"uuid_organisme\":\"0246989d-5384-49a0-8d66-c7e02e3878e9\",\"uuid_inpn\":\"ac1149e7-e099-4257-b9f7-def5050533e3\"}","{\"uuid_organisme\":\"624854a8-9ba5-46ca-9bbf-1c642ffaaffd\",\"uuid_inpn\":\"B14AA21B-AA11-44A6-B400-1DC1B48D3869\"}","{\"uuid_organisme\":\"68e254f7-bb20-4ab4-9c87-9b78902a9f0c\",\"uuid_inpn\":\"BF904CB5-14FF-4B92-81E6-B209D37D6D41\"}","{\"uuid_organisme\":\"2c2fb080-990e-4829-a951-65417c573731\",\"uuid_inpn\":\"e19e719d-ac17-4b05-827f-c625efe6d31d\"}","{\"uuid_organisme\":\"a8767c79-4dd9-4625-91d1-b6c46bc1d13a\",\"uuid_inpn\":\"F2F69A1A-CDAA-4278-93EA-FA9F4D69E855\"}","{\"uuid_organisme\":\"29c0ca0d-d168-4ce7-b9ed-ebbd5c2a1417\",\"uuid_inpn\":\"F60878DD-C8C0-45A3-9DC6-10C964925690\"}"}' :: json []
                ) json_org
        ) AS orgs
        LEFT JOIN utilisateurs.bib_organismes AS bo_chloris
            ON ((orgs.json_org) ->> 'uuid_organisme')::uuid = bo_chloris.uuid_organisme
        LEFT JOIN utilisateurs.bib_organismes AS bo_inpn
            ON ((orgs.json_org) ->> 'uuid_inpn')::uuid = bo_inpn.uuid_organisme
)
UPDATE utilisateurs.t_roles AS aa
SET id_organisme = id_org_new
FROM cor_organisme AS co
WHERE aa.id_organisme = co.id_org_old ;
--update 121l


WITH cor_organisme AS (
    SELECT
        ((orgs.json_org) ->> 'uuid_organisme')::uuid uuid_organisme,
        bo_chloris.id_organisme id_org_old,
        bo_chloris.nom_organisme nom_old,
        ((orgs.json_org) ->> 'uuid_inpn')::uuid uuid_inpn,
        bo_inpn.id_organisme id_org_new,
        bo_inpn.nom_organisme nom_new
    FROM (
            SELECT
                unnest(
                    '{"{\"uuid_organisme\":\"23d397d4-ec11-4d95-99c5-b6b5900aa176\",\"uuid_inpn\":\"139561cc-9055-43bd-aa59-911fbd87d917\"}","{\"uuid_organisme\":\"7e4c5950-aeb8-4194-b37f-67230cc5cc5f\",\"uuid_inpn\":\"1425EE63-D4F9-4FD5-94D8-2566BCD5E3E0\"}","{\"uuid_organisme\":\"3d284c5e-1005-4484-9c18-2e4771b419b2\",\"uuid_inpn\":\"14ba96b3-775a-445f-ae8c-a85a00a01835\"}","{\"uuid_organisme\":\"0fbc3acf-5063-42da-b0da-8a6bc48c6df4\",\"uuid_inpn\":\"15b23e2d-a88b-4c77-9f3e-b62dcf41fed4\"}","{\"uuid_organisme\":\"b865eb91-b78b-462e-bda4-55876b50a4c4\",\"uuid_inpn\":\"27C60AE3-D841-4197-B21E-797894EA0835\"}","{\"uuid_organisme\":\"1960c348-028e-4345-b24b-d722fc13e656\",\"uuid_inpn\":\"382179EC-F4A2-4019-A0BB-B54105C7C63F\"}","{\"uuid_organisme\":\"4de1e833-4a26-4474-a917-c0d5769c8aac\",\"uuid_inpn\":\"4008F6FB-C067-4EE7-8688-CFEE6EBAC324\"}","{\"uuid_organisme\":\"6c2e7208-75de-440b-b5f1-3a5ad5cb24e8\",\"uuid_inpn\":\"4e4a6b2d-769d-4bf6-8835-bba8b973fc35\"}","{\"uuid_organisme\":\"3d6db91d-1f9c-423b-99b3-a595f20bbef3\",\"uuid_inpn\":\"56BC65D1-9A34-4539-B25A-85B55A2A2CC5\"}","{\"uuid_organisme\":\"e127cb86-4fc3-41cb-8984-18cdcf4f8060\",\"uuid_inpn\":\"5A433BD0-1FBE-25D9-E053-2614A8C026F8\"}","{\"uuid_organisme\":\"799da30e-f934-4904-95ea-2113f384518c\",\"uuid_inpn\":\"5A433BD0-1FC0-25D9-E053-2614A8C026F8\"}","{\"uuid_organisme\":\"7f53923e-1bc2-4321-add9-96770c6c3846\",\"uuid_inpn\":\"5A433BD0-1FC6-25D9-E053-2614A8C026F8\"}","{\"uuid_organisme\":\"6c66b0f5-c07a-4ed9-b104-39152ec4b238\",\"uuid_inpn\":\"5A433BD0-1FC9-25D9-E053-2614A8C026F8\"}","{\"uuid_organisme\":\"c8b281ba-d8bb-4b77-a059-430df48c0040\",\"uuid_inpn\":\"5A433BD0-1FF6-25D9-E053-2614A8C026F8\"}","{\"uuid_organisme\":\"391409ac-3412-4986-ab46-497f1303a66c\",\"uuid_inpn\":\"5A433BD0-200F-25D9-E053-2614A8C026F8\"}","{\"uuid_organisme\":\"81ec2dc3-6ed5-4787-af7c-51848f0db75c\",\"uuid_inpn\":\"5A433BD0-200F-25D9-E053-2614A8C026F8\"}","{\"uuid_organisme\":\"76049d34-ad02-4e48-8a1a-e629f13daa1c\",\"uuid_inpn\":\"5A433BD0-2032-25D9-E053-2614A8C026F8\"}","{\"uuid_organisme\":\"3fc4579e-7e81-4233-95b2-21d0d519485e\",\"uuid_inpn\":\"5A433BD0-203A-25D9-E053-2614A8C026F8\"}","{\"uuid_organisme\":\"04942dac-ef78-4db9-9971-b04943586682\",\"uuid_inpn\":\"5A433BD0-2047-25D9-E053-2614A8C026F8\"}","{\"uuid_organisme\":\"4ba9dcf8-ad4a-49cf-bcb7-7204a240120c\",\"uuid_inpn\":\"5A433BD0-2062-25D9-E053-2614A8C026F8\"}","{\"uuid_organisme\":\"40039663-1fb9-4eb0-826b-4f4137c669df\",\"uuid_inpn\":\"5A433BD0-2070-25D9-E053-2614A8C026F8\"}","{\"uuid_organisme\":\"3289d3bf-f084-47be-a88a-b680e90b7092\",\"uuid_inpn\":\"5A433BD0-207B-25D9-E053-2614A8C026F8\"}","{\"uuid_organisme\":\"91e748f2-6cf7-49ed-844c-a8f57acd4a0b\",\"uuid_inpn\":\"5A433BD0-2083-25D9-E053-2614A8C026F8\"}","{\"uuid_organisme\":\"11123ed5-883d-45f0-8e9d-cd64ce31fd7b\",\"uuid_inpn\":\"5A433BD0-20E5-25D9-E053-2614A8C026F8\"}","{\"uuid_organisme\":\"0c142854-5a21-4fe9-8cfc-75231c2a9ffa\",\"uuid_inpn\":\"5A433BD0-20FB-25D9-E053-2614A8C026F8\"}","{\"uuid_organisme\":\"19757824-56fe-4e4a-b0f4-fea6adc2a870\",\"uuid_inpn\":\"5A433BD0-2111-25D9-E053-2614A8C026F8\"}","{\"uuid_organisme\":\"c4c9a1ef-b167-4413-966e-e71aecb696be\",\"uuid_inpn\":\"5a7c3409-1ddf-446b-b595-3677dd8d8971\"}","{\"uuid_organisme\":\"8ed10b67-cbb6-4a64-bdc3-928248f77759\",\"uuid_inpn\":\"5BD3E675-AA1F-2EBB-E053-2614A8C0CDC5\"}","{\"uuid_organisme\":\"b45837b6-f808-4b5d-84f9-41155e69c8f6\",\"uuid_inpn\":\"5be405eb-6de7-48b8-87f3-96c3d02badee\"}","{\"uuid_organisme\":\"5c754342-0500-4db8-b358-74e4a5101f9d\",\"uuid_inpn\":\"5C4B022A-17FA-6F1E-E053-2614A8C09D9F\"}","{\"uuid_organisme\":\"42ba1bbd-9bf6-40f9-9b29-41232dd72d24\",\"uuid_inpn\":\"5C4B022A-17FD-6F1E-E053-2614A8C09D9F\"}","{\"uuid_organisme\":\"8c51f403-8bae-421b-b90a-431618a5945c\",\"uuid_inpn\":\"5F301924-F1F4-5DA1-E053-2614A8C0F028\"}","{\"uuid_organisme\":\"530e3094-2b1b-4a79-b2c6-ab838bba0b78\",\"uuid_inpn\":\"5F301924-F1FA-5DA1-E053-2614A8C0F028\"}","{\"uuid_organisme\":\"ce582053-ec91-4313-9226-be34bd6a477f\",\"uuid_inpn\":\"5F832FC3-7E52-3553-E053-2614A8C09903\"}","{\"uuid_organisme\":\"b593a4a6-d789-4913-a376-558c7832aab2\",\"uuid_inpn\":\"60E6CAA2-88A3-41D3-B6D7-E02E271AF1F4\"}","{\"uuid_organisme\":\"e016bf09-eafc-43b2-9ea4-72240c1cf15a\",\"uuid_inpn\":\"62CDA494-5A11-44E1-E053-2614A8C0FAA0\"}","{\"uuid_organisme\":\"bd4b305c-9e84-4431-b79e-3fdfeb39ca0d\",\"uuid_inpn\":\"62F6DC18-1B5E-0553-E053-2614A8C052D6\"}","{\"uuid_organisme\":\"54e22f73-d59b-4e8b-87f4-4ccf58b19e21\",\"uuid_inpn\":\"62F6DC18-1B68-0553-E053-2614A8C052D6\"}","{\"uuid_organisme\":\"f04c3276-6613-462e-a617-37795ebf9e09\",\"uuid_inpn\":\"63220E12-87AA-43BD-B430-B713D1A32CE1\"}","{\"uuid_organisme\":\"4f42ac1a-98e0-4bf1-b377-df57960634bb\",\"uuid_inpn\":\"6FC806F8-A359-4FD8-98E5-EB4DD338979F\"}","{\"uuid_organisme\":\"8777011f-e32e-43e8-916c-231f52b92602\",\"uuid_inpn\":\"853A5C59-1736-4A0D-81BE-9CDCF04CED7A\"}","{\"uuid_organisme\":\"b760a61b-258b-487e-8aa3-0f39e718c97a\",\"uuid_inpn\":\"87b71ba2-eb98-11eb-b2d4-005056aa3715\"}","{\"uuid_organisme\":\"77115a43-2784-4936-b25f-8b79bd84f8cd\",\"uuid_inpn\":\"887AE811-4A08-422B-B57D-C3B3D62CCF9C\"}","{\"uuid_organisme\":\"b343f6cd-f963-4f5a-b0cf-5746cb538dde\",\"uuid_inpn\":\"92E950C4-0D5F-4EB1-B010-FFF810E5E567\"}","{\"uuid_organisme\":\"e01fd6dd-4d79-459f-9fd3-2b0306f237d0\",\"uuid_inpn\":\"95343124-0CAA-4C4D-A889-250B5DE37B52\"}","{\"uuid_organisme\":\"1bde1f82-db48-495d-88e8-c6189a440ff0\",\"uuid_inpn\":\"A14A142D-A3E0-126F-E053-2614A8C0CFBE\"}","{\"uuid_organisme\":\"8a40fb1f-23e2-4006-beb1-7499fc62e998\",\"uuid_inpn\":\"A14A142D-A482-126F-E053-2614A8C0CFBE\"}","{\"uuid_organisme\":\"948c57bf-4db6-4fd1-a9b0-decf0ef8612d\",\"uuid_inpn\":\"AAA5029C-FBE2-6BE5-E053-2614A8C07765\"}","{\"uuid_organisme\":\"0246989d-5384-49a0-8d66-c7e02e3878e9\",\"uuid_inpn\":\"ac1149e7-e099-4257-b9f7-def5050533e3\"}","{\"uuid_organisme\":\"624854a8-9ba5-46ca-9bbf-1c642ffaaffd\",\"uuid_inpn\":\"B14AA21B-AA11-44A6-B400-1DC1B48D3869\"}","{\"uuid_organisme\":\"68e254f7-bb20-4ab4-9c87-9b78902a9f0c\",\"uuid_inpn\":\"BF904CB5-14FF-4B92-81E6-B209D37D6D41\"}","{\"uuid_organisme\":\"2c2fb080-990e-4829-a951-65417c573731\",\"uuid_inpn\":\"e19e719d-ac17-4b05-827f-c625efe6d31d\"}","{\"uuid_organisme\":\"a8767c79-4dd9-4625-91d1-b6c46bc1d13a\",\"uuid_inpn\":\"F2F69A1A-CDAA-4278-93EA-FA9F4D69E855\"}","{\"uuid_organisme\":\"29c0ca0d-d168-4ce7-b9ed-ebbd5c2a1417\",\"uuid_inpn\":\"F60878DD-C8C0-45A3-9DC6-10C964925690\"}"}' :: json []
                ) json_org
        ) AS orgs
        LEFT JOIN utilisateurs.bib_organismes AS bo_chloris
            ON ((orgs.json_org) ->> 'uuid_organisme')::uuid = bo_chloris.uuid_organisme
        LEFT JOIN utilisateurs.bib_organismes AS bo_inpn
            ON ((orgs.json_org) ->> 'uuid_inpn')::uuid = bo_inpn.uuid_organisme
)
UPDATE gn_meta.cor_dataset_actor AS aa
SET id_organism = id_org_new
FROM cor_organisme AS co
WHERE aa.id_organism = co.id_org_old ;
--update 190 l


DELETE FROM utilisateurs.bib_organismes AS bo
WHERE bo.nom_organisme ILIKE '%_toDelete';
--suppresion de 337 organismes
